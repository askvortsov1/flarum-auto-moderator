module.exports=function(t){var n={};function a(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,a),o.l=!0,o.exports}return a.m=t,a.c=n,a.d=function(t,n,r){a.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,n){if(1&n&&(t=a(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)a.d(r,o,function(n){return t[n]}.bind(null,o));return r},a.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(n,"a",n),n},a.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},a.p="",a(a.s=29)}([function(t,n){t.exports=flarum.core.compat.Model},function(t,n,a){"use strict";function r(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n}a.d(n,"a",(function(){return r}))},function(t,n){t.exports=flarum.core.compat["common/utils/Stream"]},function(t,n){t.exports=flarum.core.compat["common/components/LoadingIndicator"]},function(t,n,a){"use strict";function r(){return(r=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t}).apply(this,arguments)}a.d(n,"a",(function(){return r}))},function(t,n){t.exports=flarum.core.compat["common/components/Button"]},function(t,n){t.exports=flarum.core.compat["common/extend"]},function(t,n){t.exports=flarum.core.compat["common/components/EditUserModal"]},function(t,n){t.exports=flarum.core.compat.Component},function(t,n){t.exports=flarum.core.compat["common/helpers/icon"]},function(t,n){t.exports=flarum.core.compat["common/components/GroupBadge"]},function(t,n){t.exports=flarum.core.compat["common/utils/ItemList"]},function(t,n){t.exports=flarum.core.compat["models/User"]},function(t,n,a){"use strict";a.d(n,"a",(function(){return f}));var r=a(6),o=a(7),e=a.n(o),i=a(10),s=a.n(i),c=a(3),u=a.n(c),l=a(11),p=a.n(l);function d(t){return t.filter((function(t){return t.actions()})).reduce((function(t,n){var a=n.actions().filter((function(t){return"add_to_group"===t.type||"remove_from_group"===t.type})).map((function(t){return t.settings.group_id}));t.push.apply(t,a)}),[]).map((function(t){return app.store.getById("groups",t)})).filter((function(t){return t}))}function f(){Object(r.extend)(e.a.prototype,"oninit",(function(){var t=this;this.loading=!0,app.store.find("criteria").then((function(n){d(n).forEach((function(n){return delete t.groups[n.id()]})),t.loading=!1,m.redraw()}))})),Object(r.override)(e.a.prototype,"fields",(function(t){var n=this;if(this.loading){var a=new p.a;return a.add("loading",m(u.a,null)),a}var r=t();return r.add("Criteria",m("div",{className:"Form-group"},m("label",null,app.translator.trans("askvortsov-auto-moderator.forum.edit_user.managed_groups_heading")),d(app.store.all("criteria")).map((function(t){return m("label",{className:"checkbox"},m("input",{type:"checkbox",checked:n.attrs.user.groups().includes(t),disabled:!0}),app.translator.trans("askvortsov-auto-moderator.forum.edit_user.managed_group",{badge:s.a.component({group:t,label:""}),groupName:Criterion.group().nameSingular()}))})),m("p",null,app.translator.trans("askvortsov-auto-moderator.forum.edit_user.groups_not_editable"))),10),r}))}},function(t,n,a){"use strict";a.d(n,"a",(function(){return u}));var r=a(0),o=a.n(r),e=a(12),i=a.n(e),s=a(4),c=a(1),m=function(t){function n(){return t.apply(this,arguments)||this}return Object(c.a)(n,t),n}(o.a);function u(){app.store.models.criteria=m,i.a.prototype.criteria=o.a.hasMany("criteria")}Object(s.a)(m.prototype,{name:o.a.attribute("name"),description:o.a.attribute("description"),actions:o.a.attribute("actions"),metrics:o.a.attribute("metrics"),requirements:o.a.attribute("requirements"),isValid:o.a.attribute("isValid"),invalidActionSettings:o.a.attribute("invalidActionSettings")})},function(t,n){t.exports=flarum.core.compat["common/components/Tooltip"]},function(t,n){t.exports=flarum.core.compat["common/utils/classList"]},function(t,n){t.exports=flarum.core.compat["components/Button"]},function(t,n){t.exports=flarum.core.compat["common/components/Select"]},function(t,n){t.exports=flarum.core.compat["common/components/Alert"]},function(t,n){t.exports=flarum.core.compat["utils/Stream"]},function(t,n){t.exports=flarum.core.compat["models/Group"]},function(t,n){t.exports=flarum.core.compat["admin/components/ExtensionPage"]},function(t,n){t.exports=flarum.core.compat["common/components/Link"]},function(t,n){t.exports=flarum.core.compat["common/utils/stringToColor"]},function(t,n){t.exports=flarum.core.compat["admin/components/AdminPage"]},function(t,n){t.exports=flarum.core.compat["common/components/LinkButton"]},function(t,n){t.exports=flarum.core.compat["components/Dropdown"]},function(t,n){t.exports=flarum.core.compat["helpers/icon"]},function(t,n,a){"use strict";a.r(n);var r=a(13),o=a(14),e=a(1),i=a(22),s=a.n(i),c=a(23),u=a.n(c),l=a(3),p=a.n(l),d=a(15),f=a.n(d),v=a(9),h=a.n(v),g=a(16),b=a.n(g),x=a(24),_=a.n(x);function y(t){var n=t?t.name():app.translator.trans("askvortsov-auto-moderator.admin.automoderator_page.create_criterion_button"),a=t?"fas fa-bolt":"fas fa-plus",r=t?{"background-color":_()(t.name()),color:"white"}:"";return m(u.a,{className:"ExtensionListItem",href:app.route.criterion(t)},m("span",{className:"ExtensionListItem-icon ExtensionIcon",style:r},h()(a)),m("span",{className:b()({"ExtensionListItem-title":!0,"ExtensionListItem--invalid":t&&!t.isValid()})},t&&!t.isValid()&&m(f.a,{text:app.translator.trans("askvortsov-auto-moderator.admin.automoderator_page.criterion_invalid")},h()("fas fa-exclamation-triangle")),n))}var N=function(t){function n(){return t.apply(this,arguments)||this}Object(e.a)(n,t);var a=n.prototype;return a.oninit=function(n){var a=this;t.prototype.oninit.call(this,n),this.loading=!0,app.store.find("criteria").then((function(){a.loading=!1,m.redraw()}))},a.content=function(){return this.loading?m("div",{className:"Criteria"},m("div",{className:"container"},m(p.a,null))):m("div",{className:"Criteria"},m("div",{className:"container"},m("div",{className:"ExtensionsWidget-list Criteria-list"},m("p",{className:"Criteria-list-heading"},app.translator.trans("askvortsov-auto-moderator.admin.automoderator_page.list_heading")),m("div",{className:"ExtensionList"},[].concat(app.store.all("criteria").map(y),[y()]))),m("div",{className:"Criteria-footer"},m("p",null,app.translator.trans("askvortsov-auto-moderator.admin.automoderator_page.instructions_header")),m("ul",null,app.translator.trans("askvortsov-auto-moderator.admin.automoderator_page.instructions_text")))))},n}(s.a),k=a(4),O=a(25),E=a.n(O),L=a(19),w=a.n(L),D=a(5),S=a.n(D),j=a(26),B=a.n(j),G=a(18),C=a.n(G),F=a(2),M=a.n(F),I=a(8),T=a.n(I),q=a(17),A=a.n(q),P=a(20),W=a.n(P),K=function(t){function n(){return t.apply(this,arguments)||this}Object(e.a)(n,t);var a=n.prototype;return a.oninit=function(n){t.prototype.oninit.call(this,n),this.state=-1,-1!==this.attrs.min()&&(this.state+=1),-1!==this.attrs.max()&&(this.state+=2),this.min=W()(this.attrs.min()),this.max=W()(this.attrs.max())},a.view=function(){return m("div",{className:"Form-group MinMaxSelector"},m("label",null,this.attrs.label),m("div",{className:"MinMaxSelector--inputs"},this.controls()))},a.controls=function(){var t=this,a=function(){return m("input",{className:"FormControl",type:"number",min:"0",max:t.state===n.State.BETWEEN?-1!==t.attrs.max()?t.attrs.max():t.max():1/0,placeholder:"min",bidi:t.attrs.min})},r=function(){return m("input",{className:"FormControl",type:"number",min:t.state===Math.max(0,n.State.BETWEEN?-1!==t.attrs.min()?t.attrs.min():t.min():0),placeholder:"max",bidi:t.attrs.max})},o=function(){return m("input",{className:"FormControl MinMaxSelector--placeholder",disabled:!0,placeholder:"X"})},e=function(n){return m(A.a,{className:"Button",onclick:t.cycle.bind(t),icon:n})};switch(this.state){case n.State.LTE:return[o(),e("fas fa-less-than-equal"),r()];case n.State.GTE:return[o(),e("fas fa-greater-than-equal"),a()];case n.State.BETWEEN:return[a(),e("fas fa-less-than-equal"),o(),e("fas fa-less-than-equal"),r()]}},a.cycle=function(){switch(this.state++,this.state%=3,-1!==this.attrs.min()&&this.min(this.attrs.min()),-1!==this.attrs.max()&&this.max(this.attrs.max()),this.state){case n.State.GTE:this.attrs.min(this.min()),this.attrs.max(-1);break;case n.State.LTE:this.attrs.min(-1),this.attrs.max(this.max());break;case n.State.BETWEEN:this.attrs.min(this.min()),this.attrs.max(this.max())}},n}(T.a);K.State={GTE:0,LTE:1,BETWEEN:2};var V,R,U=K;function z(t,n){var a=R[t.type];return m("li",null,m("div",{className:b()({"DriverListItem-info":!0,"DriverListItem--missingExt":a.missingExt})},a.missingExt&&m(f.a,{text:app.translator.trans("askvortsov-auto-moderator.admin.criterion_page.driver_missing_ext")},h()("fas fa-exclamation-triangle")),m("span",{className:"DriverListItem-name"},app.translator.trans(a.translationKey)),S.a.component({className:"Button Button--link",icon:"fas fa-trash-alt",onclick:function(){return n(n().filter((function(n){return n!==t})))}})),m(U,{min:t.min,max:t.max}),m("hr",null))}function X(t,n){var a,r=V[t.type],o=app["askvortsov-auto-moderator"].actionDriverSettingsComponents;return a=t.type in o?o[t.type].component({action:t,actionDef:r}):Object.keys(r.availableSettings).map((function(n){return m("div",{className:"Form-group"},m("input",{className:"FormControl",value:t.settings[n],onchange:function(a){return t.settings[n]=a.target.value},placeholder:app.translator.trans(r.availableSettings[n])}))})),m("li",null,m("div",{className:b()({"DriverListItem-info":!0,"DriverListItem--missingExt":r.missingExt})},r.missingExt&&m(f.a,{text:app.translator.trans("askvortsov-auto-moderator.admin.criterion_page.driver_missing_ext")},h()("fas fa-exclamation-triangle")),m("span",{className:"DriverListItem-name"},app.translator.trans(r.translationKey)),S.a.component({className:"Button Button--link",icon:"fas fa-trash-alt",onclick:function(){return n(n().filter((function(n){return n!==t})))}}),m("div",{className:"DriverListItem-form"},a)),m("hr",null))}var H=function(t){function n(){return t.apply(this,arguments)||this}Object(e.a)(n,t);var a=n.prototype;return a.oninit=function(n){var a=this;t.prototype.oninit.call(this,n),this.id=m.route.param("id"),this.name=M()(""),this.description=M()(""),this.actionsOnGain=M()([]),this.actionsOnLoss=M()([]),this.metrics=M()([]),this.requirements=M()([]),this.newMetric=M()(""),this.newActionOnGain=M()(""),this.newActionOnLoss=M()(""),this.loadingDrivers=!0,app.request({method:"GET",url:app.forum.attribute("apiUrl")+"/automod_drivers"}).then((function(t){V=t.data.attributes.action,R=t.data.attributes.metric,a.loadingDrivers=!1,m.redraw()})),"new"!==this.id&&(this.loadingCriterion=!0,app.store.find("criteria",this.id).then((function(t){a.criterion=t,a.name(t.name()),a.description(t.description()),a.metrics(t.metrics().map((function(t){return{type:t.type,min:M()(t.min),max:M()(t.max)}}))),a.actionsOnGain(t.actions().filter((function(t){return t.gain}))),a.actionsOnLoss(t.actions().filter((function(t){return!t.gain}))),a.requirements(t.requirements()),a.loadingCriterion=!1,m.redraw()})))},a.headerInfo=function(){var t,n="";return this.loadingCriterion?(n=app.translator.trans("askvortsov-auto-moderator.admin.criterion_page.loading"),t=app.translator.trans("askvortsov-auto-moderator.admin.criterion_page.loading")):t=this.criterion?this.criterion.name():app.translator.trans("askvortsov-auto-moderator.admin.criterion_page.new_criterion"),{className:"CriterionPage",icon:"fas fa-bolt",title:t,description:n}},a.content=function(){return this.loadingCriterion||this.loadingDrivers?m("div",{className:"Criteria"},m("div",{className:"container"},m(p.a,null))):m("div",{className:"Criteria"},m("div",{className:"container"},m("form",{onsubmit:this.onsubmit.bind(this)},m("div",{className:"Form-group"},m(B.a,{className:"Button",icon:"fas fa-chevron-left",href:app.route("extension",{id:"askvortsov-auto-moderator"})},app.translator.trans("askvortsov-auto-moderator.admin.criterion_page.back"))),m("div",{className:"Form-group"},this.errors()),m("div",{className:"Form-group"},m("label",null,app.translator.trans("askvortsov-auto-moderator.admin.criterion_page.name_label")),m("input",{className:"FormControl",bidi:this.name,required:!0})),m("div",{className:"Form-group"},m("label",null,app.translator.trans("askvortsov-auto-moderator.admin.criterion_page.description_label")),m("input",{className:"FormControl",bidi:this.description})),this.metricsAndRequirementsForm(),this.actionsForm(),m("div",{className:"Form-group"},m(S.a,{type:"submit",className:"Button Button--primary",loading:this.saving,disabled:this.saving},app.translator.trans("core.admin.settings.submit_button"))),this.criterion&&m(S.a,{type:"button",onclick:this.delete.bind(this),className:"Button Button--danger",loading:this.deleting,disabled:this.saving},app.translator.trans("askvortsov-auto-moderator.admin.criterion_page.delete_button")))))},a.errors=function(){if(this.criterion){var t=[];this.criterion.isValid()||t.push(m(w.a,{type:"error",dismissible:!1},app.translator.trans("askvortsov-auto-moderator.admin.criterion_page.invalid")));var n=this.criterion.invalidActionSettings();return n&&Object.keys(n).length&&t.push(m(w.a,{type:"error",dismissible:!1},app.translator.trans("askvortsov-auto-moderator.admin.criterion_page.validation"),m("div",null,m("ol",null,Object.keys(n).map((function(t){return m("li",null,m("strong",null,t,":")," ",n[t].join(""))})))))),m("div",{className:"StatusCheck"},t)}},a.metricsAndRequirementsForm=function(){var t=this;return m("div",{className:"Form-group"},m("label",null,app.translator.trans("askvortsov-auto-moderator.admin.criterion_page.metrics_and_requirements_label")),m("div",{className:"helpText"},app.translator.trans("askvortsov-auto-moderator.admin.criterion_page.metrics_and_requirements_help")),m("div",{className:"SettingsGroups"},m("div",{className:"DriverGroup"},m("label",null,app.translator.trans("askvortsov-auto-moderator.admin.criterion_page.metrics_heading")),m("ul",{className:"DriverList DriverList--primary"},this.metrics().map((function(n){return z(n,t.metrics)}))),m("span",{class:"DriverGroup-controls"},C.a.component({options:Object.keys(R).reduce((function(t,n){return t[n]=app.translator.trans(R[n].translationKey),t}),{}),value:this.newMetric(),onchange:this.newMetric}),S.a.component({className:"Button DriverList-button",icon:"fas fa-plus",disabled:!this.newMetric(),onclick:function(){t.metrics([].concat(t.metrics(),[{type:t.newMetric(),min:M()(),max:M()()}]))}})))))},a.actionsForm=function(){var t=this;return m("div",{className:"Form-group"},m("label",null,app.translator.trans("askvortsov-auto-moderator.admin.criterion_page.actions_label")),m("div",{className:"helpText"},app.translator.trans("askvortsov-auto-moderator.admin.criterion_page.actions_help")),m("div",{className:"SettingsGroups"},m("div",{className:"DriverGroup"},m("label",null,app.translator.trans("askvortsov-auto-moderator.admin.criterion_page.actions_on_gain_heading")),m("ul",{className:"DriverList DriverList--primary"},this.actionsOnGain().map((function(n){return X(n,t.actionsOnGain)}))),m("span",{class:"DriverGroup-controls"},C.a.component({options:Object.keys(V).reduce((function(t,n){return t[n]=app.translator.trans(V[n].translationKey),t}),{}),value:this.newActionOnGain(),onchange:this.newActionOnGain}),S.a.component({className:"Button DriverList-button",icon:"fas fa-plus",disabled:!this.newActionOnGain(),onclick:function(){t.actionsOnGain([].concat(t.actionsOnGain(),[{type:t.newActionOnGain(),settings:{}}]))}}))),m("div",{className:"DriverGroup DriverGroup--secondary"},m("label",null,app.translator.trans("askvortsov-auto-moderator.admin.criterion_page.actions_on_loss_heading")),m("ul",{className:"DriverList"},this.actionsOnLoss().map((function(n){return X(n,t.actionsOnLoss)}))),m("span",{class:"DriverGroup-controls"},C.a.component({options:Object.keys(V).reduce((function(t,n){return t[n]=app.translator.trans(V[n].translationKey),t}),{}),value:this.newActionOnLoss(),onchange:this.newActionOnLoss}),S.a.component({className:"Button DriverList-button",icon:"fas fa-plus",disabled:!this.newActionOnLoss(),onclick:function(){t.actionsOnLoss([].concat(t.actionsOnLoss(),[{type:t.newActionOnLoss(),settings:{}}]))}})))))},a.data=function(){return{name:this.name(),description:this.description(),actions:[].concat(this.actionsOnGain().map((function(t){return Object(k.a)({},t,{gain:!0})})),this.actionsOnLoss().map((function(t){return Object(k.a)({},t,{gain:!1})}))),metrics:this.metrics().map((function(t){return{type:t.type,min:t.min(),max:t.max()}})),requirements:this.requirements()}},a.delete=function(t){t.preventDefault(),this.deleting=!0,m.redraw(),this.criterion.delete().then((function(){m.route.set(app.route("extension",{id:"askvortsov-auto-moderator"}))}))},a.onsubmit=function(t){var n=this;t.preventDefault(),this.saving=!0,m.redraw(),(this.criterion||app.store.createRecord("criteria")).save(this.data()).then((function(){n.saving=!1,m.redraw()}))},n}(E.a),J=a(27),Q=a.n(J),Y=a(28),Z=a.n(Y),$=a(21),tt=a.n($),nt=function(t){function n(){return t.apply(this,arguments)||this}return Object(e.a)(n,t),n.prototype.view=function(){var t=this,n=app.store.getById("groups",this.attrs.value),a=n?[Z()(n.icon()),"\t",n.namePlural()]:app.translator.trans("askvortsov-auto-moderator.admin.group_selector.placeholder");return m("div",{className:"Form-group"},m("label",null,this.attrs.label),this.attrs.disabled?m("div",{className:"Button Button--danger"},a):m(Q.a,{label:a,disabled:this.attrs.disabled,buttonClassName:"Button Button--danger"},app.store.all("groups").filter((function(t){return![tt.a.MEMBER_ID,tt.a.GUEST_ID].includes(t.id())})).map((function(a){return A.a.component({active:n&&n.id()===a.id(),disabled:n&&n.id()===a.id(),icon:a.icon(),onclick:function(){t.attrs.onchange(a.id())}},a.namePlural())}))))},n}(T.a),at=function(t){function n(){return t.apply(this,arguments)||this}return Object(e.a)(n,t),n.prototype.view=function(){var t=this.attrs.action;return m(nt,{value:t.settings.group_id,onchange:function(n){return t.settings={group_id:n}}})},n}(T.a);app.initializers.add("askvortsov/flarum-auto-moderator",(function(){app.routes.criterion={path:"/askvortsov-auto-moderator/criterion/:id",component:H},app["askvortsov-auto-moderator"]={actionDriverSettingsComponents:{add_to_group:at,remove_from_group:at}},app.extensionData.for("askvortsov-auto-moderator").registerPage(N),app.route.criterion=function(t){return app.route("criterion",{id:(null==t?void 0:t.id())||"new"})},Object(r.a)(),Object(o.a)()}))}]);
//# sourceMappingURL=admin.js.map