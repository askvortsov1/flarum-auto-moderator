module.exports=function(t){var e={};function a(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,a),s.l=!0,s.exports}return a.m=t,a.c=e,a.d=function(t,e,r){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)a.d(r,s,function(e){return t[e]}.bind(null,s));return r},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=20)}([function(t,e){t.exports=flarum.core.compat.Model},function(t,e,a){"use strict";function r(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}a.d(e,"a",(function(){return r}))},function(t,e){t.exports=flarum.core.compat["utils/Stream"]},function(t,e){t.exports=flarum.core.compat["components/LoadingIndicator"]},function(t,e){t.exports=flarum.core.compat["components/Button"]},function(t,e){t.exports=flarum.core.compat["models/User"]},function(t,e){t.exports=flarum.core.compat["utils/ItemList"]},function(t,e,a){"use strict";a.r(e),a.d(e,"default",(function(){return m}));var r=a(0),s=a.n(r),n=a(5),o=a.n(n);function i(){return(i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t}).apply(this,arguments)}var l=a(1),u=function(t){function e(){return t.apply(this,arguments)||this}return Object(l.a)(e,t),e}(s.a);function m(){app.store.models.trust_levels=u,o.a.prototype.trustLevels=s.a.hasMany("trustLevels")}i(u.prototype,{name:s.a.attribute("name"),group:s.a.hasOne("group"),metrics:s.a.attribute("metrics")})},function(t,e){t.exports=flarum.core.compat["helpers/icon"]},function(t,e){t.exports=flarum.core.compat.Component},,,function(t,e){t.exports=flarum.core.compat["models/Group"]},,,function(t,e){t.exports=flarum.core.compat["components/ExtensionPage"]},function(t,e){t.exports=flarum.core.compat["components/Modal"]},function(t,e){t.exports=flarum.core.compat["components/Dropdown"]},,,function(t,e,a){"use strict";a.r(e);var r=a(7),s=a(1),n=a(15),o=a.n(n),i=a(3),l=a.n(i),u=a(8),c=a.n(u),p=a(16),d=a.n(p),v=a(4),f=a.n(v),h=a(6),b=a.n(h),g=a(2),x=a.n(g),_=a(9),y=a.n(_),E=function(t){function e(){return t.apply(this,arguments)||this}Object(s.a)(e,t);var a=e.prototype;return a.oninit=function(a){t.prototype.oninit.call(this,a),this.state=e.State.DISABLED,-1!==this.attrs.min()&&(this.state+=1),-1!==this.attrs.max()&&(this.state+=2),this.min=x()(this.attrs.min()),this.max=x()(this.attrs.max())},a.view=function(){return m("div",{className:"Form-group MinMaxSelector"},m("label",null,this.attrs.label),m("div",{className:"MinMaxSelector--inputs"},this.controls()))},a.controls=function(){var t=this,a=function(){return m("input",{className:"FormControl",type:"number",min:"0",max:t.state===e.State.BETWEEN?-1!==t.attrs.max()?t.attrs.max():t.max():1/0,placeholder:"min",bidi:t.attrs.min})},r=function(){return m("input",{className:"FormControl",type:"number",min:t.state===Math.max(0,e.State.BETWEEN?-1!==t.attrs.min()?t.attrs.min():t.min():0),placeholder:"max",bidi:t.attrs.max})},s=function(){return m("input",{className:"FormControl MinMaxSelector--placeholder",disabled:!0,placeholder:"X"})},n=function(e){return m(f.a,{className:"Button",onclick:t.cycle.bind(t),icon:e})};switch(this.state){case e.State.DISABLED:return n("fas fa-power-off");case e.State.LTE:return[s(),n("fas fa-less-than-equal"),r()];case e.State.GTE:return[s(),n("fas fa-greater-than-equal"),a()];case e.State.BETWEEN:return[a(),n("fas fa-less-than-equal"),s(),n("fas fa-less-than-equal"),r()]}},a.cycle=function(){switch(this.state++,this.state%=4,-1!==this.attrs.min()&&this.min(this.attrs.min()),-1!==this.attrs.max()&&this.max(this.attrs.max()),this.state){case e.State.DISABLED:this.attrs.min(-1),this.attrs.max(-1);break;case e.State.GTE:this.attrs.min(this.min()),this.attrs.max(-1);break;case e.State.LTE:this.attrs.min(-1),this.attrs.max(this.max());break;case e.State.BETWEEN:this.attrs.min(this.min()),this.attrs.max(this.max())}},e}(y.a);E.State={DISABLED:0,GTE:1,LTE:2,BETWEEN:3};var N=E,L=a(17),S=a.n(L),T=a(12),k=a.n(T),M=function(t){function e(){return t.apply(this,arguments)||this}return Object(s.a)(e,t),e.prototype.view=function(){var t=this,e=app.store.getById("groups",this.attrs.id()),a=e?[c()(e.icon()),"\t",e.namePlural()]:app.translator.trans("askvortsov-trust-levels.admin.group_selector.placeholder");return m("div",{className:"Form-group"},m("label",null,this.attrs.label),this.attrs.disabled?m("div",{className:"Button Button--danger"},a):m(S.a,{label:a,disabled:this.attrs.disabled,buttonClassName:"Button Button--danger"},app.store.all("groups").filter((function(t){return![k.a.MEMBER_ID,k.a.GUEST_ID].includes(t.id())})).map((function(a){return f.a.component({active:e&&e.id()===a.id(),disabled:e&&e.id()===a.id(),icon:a.icon(),onclick:function(){t.attrs.id(a.id())}},a.namePlural())}))))},e}(y.a),B=function(t){function e(){return t.apply(this,arguments)||this}Object(s.a)(e,t);var a=e.prototype;return a.oninit=function(e){var a=this;t.prototype.oninit.call(this,e),this.trustLevel=this.attrs.model||app.store.createRecord("trust_levels");var r=this.trustLevel.group();this.groupId=x()(r?r.id():null),this.name=x()(this.trustLevel.name()||""),this.loading=!0,app.request({method:"GET",url:app.forum.attribute("apiUrl")+"/trust_level_drivers"}).then((function(t){a.metricTranslations=t.data.attributes.drivers,a.metrics=Object.keys(a.metricTranslations),a.metrics.forEach((function(t){var e=a.trustLevel.metrics()||[],r=e["min"+t],s=e["max"+t];a["min"+t]=x()(r||-1),a["max"+t]=x()(s||-1)})),a.loading=!1,m.redraw()}))},a.className=function(){return"EditTrustLevelModal Modal--small"},a.title=function(){return this.name()?this.name():app.translator.trans("askvortsov-trust-levels.admin.trust_level_modal.title")},a.content=function(){return this.loading?m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"container"},m(l.a,null)))):m("div",{className:"Modal-body"},m("div",{className:"Form"},this.fields().toArray()))},a.fields=function(){var t=this,e=new b.a;return e.add("name",m("div",{className:"Form-group"},m("label",null,app.translator.trans("askvortsov-trust-levels.admin.trust_level_modal.name_label")),m("input",{className:"FormControl",placeholder:app.translator.trans("askvortsov-trust-levels.admin.trust_level_modal.name_placeholder"),bidi:this.name})),50),e.add("group",m("div",{className:"Form-group"},m(M,{label:app.translator.trans("askvortsov-trust-levels.admin.trust_level_modal.group_label"),id:this.groupId,disabled:this.trustLevel.exists})),50),this.metrics.forEach((function(a){e.add(a,m(N,{label:app.translator.trans(t.metricTranslations[a]),min:t["min"+a],max:t["max"+a]}),40)})),e.add("submit",m("div",{className:"Form-group"},f.a.component({type:"submit",className:"Button Button--primary EditTrustLevelModal-save",loading:this.loading,disabled:0===this.name().length||!this.groupId()},app.translator.trans("askvortsov-trust-levels.admin.trust_level_modal.submit_button")),this.trustLevel.exists?m("button",{type:"button",className:"Button EditTrustLevelModal-delete",onclick:this.delete.bind(this)},app.translator.trans("askvortsov-trust-levels.admin.trust_level_modal.delete_button")):""),-10),e},a.submitData=function(){var t=this,e=app.store.getById("groups",this.groupId()),a={name:this.name(),relationships:{group:e}};return this.metrics.forEach((function(e){a["min"+e]=t["min"+e](),a["max"+e]=t["max"+e]()})),a},a.onsubmit=function(t){var e=this;t.preventDefault(),this.loading=!0,this.trustLevel.save(this.submitData()).then((function(){return e.hide()}),(function(){return e.loading=!1}))},a.delete=function(){confirm(app.translator.trans("askvortsov-trust-levels.admin.trust_level_modal.delete_confirmation"))&&(this.trustLevel.delete().then((function(){m.redraw()})),this.hide())},e}(d.a);function O(t){var e=t?t.name():app.translator.trans("askvortsov-trust-levels.admin.trust_level_page.create_trust_level_button"),a=t?t.group().icon():"fas fa-plus",r=t?{"background-color":t.group().color(),color:"white"}:"";return m("div",{className:"ExtensionListItem",onclick:function(){return app.modal.show(B,{model:t})}},m("span",{className:"ExtensionListItem-icon ExtensionIcon",style:r},c()(a)),m("span",{className:"ExtensionListItem-title"},e))}var I=function(t){function e(){return t.apply(this,arguments)||this}Object(s.a)(e,t);var a=e.prototype;return a.oninit=function(e){var a=this;t.prototype.oninit.call(this,e),this.loading=!0,app.store.find("trust_levels").then((function(){a.loading=!1,m.redraw()}))},a.content=function(){return this.loading?m("div",{className:"TrustLevels"},m("div",{className:"container"},m(l.a,null))):m("div",{className:"TrustLevels"},m("div",{className:"container"},m("div",{className:"ExtensionsWidget-list TrustLevels-list"},m("p",{className:"TrustLevels-list-heading"},app.translator.trans("askvortsov-trust-levels.admin.trust_level_page.list_heading")),m("div",{className:"ExtensionList"},[].concat(app.store.all("trust_levels").map(O),[O()]))),m("div",{className:"TrustLevels-footer"},m("p",null,app.translator.trans("askvortsov-trust-levels.admin.trust_level_page.instructions_header")),m("ul",null,app.translator.trans("askvortsov-trust-levels.admin.trust_level_page.instructions_text")))))},e}(o.a);app.initializers.add("askvortsov/flarum-trust-levels",(function(){app.extensionData.for("askvortsov-trust-levels").registerPage(I),Object(r.default)()}))}]);
//# sourceMappingURL=admin.js.map